<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-2396877498000532",
    enable_page_level_ads: true
  });
</script>
    
    <title>Write Machine Learning Algorithms From Scratch: Random Forest | Searene</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="machine learning" />
    
    <meta name="description" content="IntroductionRandom Forest is a supervised classification algorithm, it can classify data according to various given features. Assuming that we want to determine whether a person is male or female acco">
<meta name="keywords" content="machine learning">
<meta property="og:type" content="article">
<meta property="og:title" content="Write Machine Learning Algorithms From Scratch: Random Forest">
<meta property="og:url" content="http://searene.me/2017/12/23/Write-Machine-Learning-Algorithms-From-Scratch-Random-Forest/index.html">
<meta property="og:site_name" content="Searene">
<meta property="og:description" content="IntroductionRandom Forest is a supervised classification algorithm, it can classify data according to various given features. Assuming that we want to determine whether a person is male or female acco">
<meta property="og:image" content="http://searene.me/images/forest.jpg">
<meta property="og:updated_time" content="2018-01-09T15:24:17.817Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Write Machine Learning Algorithms From Scratch: Random Forest">
<meta name="twitter:description" content="IntroductionRandom Forest is a supervised classification algorithm, it can classify data according to various given features. Assuming that we want to determine whether a person is male or female acco">
<meta name="twitter:image" content="http://searene.me/images/forest.jpg">
    

    

    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/titillium-web/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
        <link rel="stylesheet" href="/vendor/scrollLoading/style.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71019366-1', 'auto');
ga('send', 'pageview');

</script>
    
    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Coding/">Coding</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Journal/">Journal</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Journey/">Journey</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Math/">Math</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Coding/">Coding</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-Write-Machine-Learning-Algorithms-From-Scratch-Random-Forest" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Write Machine Learning Algorithms From Scratch: Random Forest
        </h1>
    

            </header>
        
        <div class="article-subtitle">
            <a href="/2017/12/23/Write-Machine-Learning-Algorithms-From-Scratch-Random-Forest/" class="article-date">
    <time datetime="2017-12-23T02:14:33.000Z" itemprop="datePublished">2017-12-23</time>
</a>
            
    <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/machine-learning/">machine learning</a></li></ul>

        </div>
        <div class="article-entry" itemprop="articleBody">
            <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Random Forest is a supervised classification algorithm, it can classify data according to various given features.</p>
<p>Assuming that we want to determine whether a person is male or female according to his/her weight, height and 100m-race time. Training data is as follows.</p>
<table>
<thead>
<tr>
<th>Person</th>
<th>Weight(kg)</th>
<th>Height(meter)</th>
<th>100m-race time(second)</th>
<th>Gender</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>50</td>
<td>1.62</td>
<td>18</td>
<td>Female</td>
</tr>
<tr>
<td>B</td>
<td>70</td>
<td>1.81</td>
<td>16</td>
<td>Male</td>
</tr>
<tr>
<td>C</td>
<td>60</td>
<td>1.72</td>
<td>15</td>
<td>Female</td>
</tr>
<tr>
<td>D</td>
<td>70</td>
<td>1.71</td>
<td>19</td>
<td>Male</td>
</tr>
<tr>
<td>E</td>
<td>52</td>
<td>1.69</td>
<td>17</td>
<td>Female</td>
</tr>
</tbody>
</table>
<p>We can load these data and train them with the random forest classification algorithm. The model obtained from training could be used for prediction. E.g., We will be able to predict this person’s gender using the trained model.</p>
<table>
<thead>
<tr>
<th>Weight(kg)</th>
<th>Height(meter)</th>
<th>100m-race time(second)</th>
</tr>
</thead>
<tbody>
<tr>
<td>60</td>
<td>1.62</td>
<td>16</td>
</tr>
</tbody>
</table>
<p>Notice that we will mainly focus on how to use random forest and how to write the algorithm from scratch. We won’t dive into the esoteric mathematical principles behind it. After finishing this post, you will be able to understand various parameters seen in third-party random forest implementations.</p>
<p>All the code mentioned in the post is available for download. So please refer to the code if there’s anything unclear in the post.</p>
<h1 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h1><p>Let’s first run the code that we will write, so we could know what it’s like.</p>
<ol>
<li><p>Install Python3</p>
</li>
<li><p>Download code</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> git@github.com:searene/demos.git &amp;&amp; <span class="built_in">cd</span> demos/RandomForest</div></pre></td></tr></table></figure>
</li>
<li><p>Download Dependencies</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install numpy pandas</div></pre></td></tr></table></figure>
</li>
<li><p>Execution</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">python evaluate_random_forest.py</div><div class="line">Average cross validation accuracy <span class="keyword">for</span> 1 trees: 0.6887700534759359</div><div class="line">Test accuracy <span class="keyword">for</span> 1 trees: 0.6190476190476191</div><div class="line">Average cross validation accuracy <span class="keyword">for</span> 3 trees: 0.6898395721925135</div><div class="line">Test accuracy <span class="keyword">for</span> 3 trees: 0.8571428571428571</div><div class="line">Average cross validation accuracy <span class="keyword">for</span> 10 trees: 0.6983957219251338</div><div class="line">Test accuracy <span class="keyword">for</span> 10 trees: 0.7619047619047619</div></pre></td></tr></table></figure>
</li>
</ol>
<p>So you can see that, we get the highest accuracy with 3 trees, which is about 85%.</p>
<h1 id="How-It-Works"><a href="#How-It-Works" class="headerlink" title="How It Works"></a>How It Works</h1><p>Random Forest is rather complex, so let’s use an example.</p>
<table>
<thead>
<tr>
<th>Person</th>
<th>Weight(kg)</th>
<th>Height(meter)</th>
<th>100m-race time(second)</th>
<th>Gender</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>50</td>
<td>1.62</td>
<td>18</td>
<td>Female</td>
</tr>
<tr>
<td>B</td>
<td>70</td>
<td>1.81</td>
<td>16</td>
<td>Male</td>
</tr>
<tr>
<td>C</td>
<td>60</td>
<td>1.72</td>
<td>15</td>
<td>Female</td>
</tr>
<tr>
<td>D</td>
<td>70</td>
<td>1.71</td>
<td>19</td>
<td>Male</td>
</tr>
<tr>
<td>E</td>
<td>52</td>
<td>1.69</td>
<td>17</td>
<td>Female</td>
</tr>
</tbody>
</table>
<p>We mentioned before that we could use these data to train our random forest model, in order to predict new items. So how to train? In fact, training is equivalent to building a tree here. Steps are as follows.</p>
<ol>
<li><p>Based on D’s height, anyone whose height is less or equal to 1.71m belong to one group, and anyone whose height is greater than 1.71m belong to another group, then we get two groups(Don’t think too much about why to split in this way, this is just an example, we will talk about the reason in detail later).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">     A, B, C, D, E</div><div class="line">    /             \</div><div class="line">   /               \</div><div class="line">A, D, E           B, C</div></pre></td></tr></table></figure>
</li>
<li><p>For group <code>A, D, E</code>, based on A’s 100m-race time, anyone whose time is less or equal to 18s belong to one group, and anyone whose time is greater than 18s belong to another group. The same goes to group <code>B, C</code>. Based on C’s height, anyone whose height is less than or equal to 1.72m belong to one group, and anyone whose height is greater than 1.72m belong to another group. After splitting, we get a tree like this.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">       A, B, C, D, E</div><div class="line">      /             \</div><div class="line">     /               \</div><div class="line">   B, C            A, D, E</div><div class="line">  /    \          /      \</div><div class="line"> /      \        /        \</div><div class="line">C        B     A, E        D</div></pre></td></tr></table></figure>
</li>
<li><p>Now only group <code>A, E</code> could be further split. So let’s base on A’s weight, anyone whose weight is less than or equal to 50kg belong to one group, and anyone whose weight is greater than 50kg belong to another group. After that, we mark each leaf node with their genders.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          A, B, C, D, E</div><div class="line">         /             \</div><div class="line">        /               \</div><div class="line">      B, C            A, D, E</div><div class="line">     /    \          /      \</div><div class="line">    /      \        /        \</div><div class="line">C(F)       B(M)   A, E       D(M)</div><div class="line">                  /   \</div><div class="line">                 /     \</div><div class="line">               A(F)   E(M)</div></pre></td></tr></table></figure>
<p>That’s it, a tree in the random forest! Now we can use this tree to predict new data. Assuming we want to predict this person’s gender:</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Weight(kg)</th>
<th>Height(meter)</th>
<th>100m-race time(second)</th>
</tr>
</thead>
<tbody>
<tr>
<td>60</td>
<td>1.62</td>
<td>16</td>
</tr>
</tbody>
</table>
<p>   Just like training, this person’s height is 1.62m, which is less than or equal to 1.71, so he/she belongs to group <code>B, C</code> in the second layer. Again, compare based on his/her height, which is less than or equal to 1.72m, so he/she belongs to leaf node C, which means the prediction result is <code>Female</code>. This is the whole process of prediction.</p>
<h1 id="The-Principle-To-Split-A-Tree-Into-Two-Groups"><a href="#The-Principle-To-Split-A-Tree-Into-Two-Groups" class="headerlink" title="The Principle To Split A Tree Into Two Groups"></a>The Principle To Split A Tree Into Two Groups</h1><p>   In the above example, we first split the whole data into two groups according to D’s height, then continue to split them according to D’s height, A’s weight, etc. What’s going on here? It seemed that we were casually splitting the data with no principle. OK, I concede that it’s true. I just want to show you guys how to build a random forest tree. In fact, the genuine tree-building-process would split the data according to gini index. E.g., assuming we split the data according to A’s weight, we will get two groups of data: <code>A</code> and <code>B, C, D, E</code>. Let’s call them group1 and group2 respectively, then we can calculate gini index according to the following equation.</p>
   <div style="background-color: #fff5cc; border-color: #ffe273; padding: 10px; border-left: 10px solid #ffe273">$gini$ = [1 - (the number of males in group1 / the number of people in group1)$^2$ - (the number of females in group1 / the number of people in group1)$^2$] $\times$ (the number of people in group1 / the total number of people in both groups) + [1 - (the number of males in group2 / the number of people in group2)$^2$ - (the number of females in group2 / the number of people in group2)$^2$] $\times$ (the number of people in group2 / the total number of people in both groups)</div>

<p>   So the gini index should be calculated as follows if we split the data based on A’s weight.<br>$$<br>   gini = 0 + (1 - 0.25 - 0.25) \times 0.8 = 0.4<br>$$</p>
<p>   We can also split the data based on A’s height, to get another gini index.<br>$$<br>   gini = 0 + (1 - 0.25 - 0.25) \times 0.8 = 0.4<br>$$<br>We can also split based on A’s 100m-race time, B’s weight, B’s height, …, E’s 100m-race time, 3 x 5 = 15 ways in total. We calculate the gini index for each of the 15 ways, and choose the one with the smallest gini index. So we should split based on D’s weight if we got the smallest gini index based on D’s weight. Why choose the smallest one? Because the smaller gini index is, the purer each group will be. We are not going to dive into the reason in detail here because it’s more about the math rather than the implementation.</p>
<p>The code to calculate gini index is as follows.</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_gini_index</span><span class="params">(left, right, categories)</span>:</span></div><div class="line">    gini_index = <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> group <span class="keyword">in</span> left, right:</div><div class="line">        <span class="keyword">if</span> len(group) == <span class="number">0</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        score = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> category <span class="keyword">in</span> categories:</div><div class="line">            p = [row[<span class="number">-1</span>] <span class="keyword">for</span> row <span class="keyword">in</span> group].count(category) / len(group)</div><div class="line">            score += p * p</div><div class="line">        gini_index += (<span class="number">1</span> - score) * (len(group) / len(left + right))</div><div class="line">    <span class="keyword">return</span> gini_index</div></pre></td></tr></table></figure>
<p>   We use the above piece of code in this way:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">A = [<span class="number">50</span>, <span class="number">1.62</span>, <span class="number">18</span>, <span class="string">'Female'</span>]</div><div class="line">B = [<span class="number">70</span>, <span class="number">1.81</span>, <span class="number">16</span>, <span class="string">'Male'</span>]</div><div class="line">C = [<span class="number">60</span>, <span class="number">1.72</span>, <span class="number">15</span>, <span class="string">'Female'</span>]</div><div class="line">D = [<span class="number">70</span>, <span class="number">1.71</span>, <span class="number">19</span>, <span class="string">'Male'</span>]</div><div class="line">E = [<span class="number">52</span>, <span class="number">1.69</span>, <span class="number">17</span>, <span class="string">'Female'</span>]</div><div class="line">left = [A]</div><div class="line">right = [B, C, D, E]</div><div class="line">gini_index = get_gini_index(left, right, [<span class="string">'Male'</span>, <span class="string">'Female'</span>])</div><div class="line">print(gini_index) <span class="comment"># 0.4</span></div></pre></td></tr></table></figure>
<h1 id="Use-multiple-trees-to-boost-the-accuracy"><a href="#Use-multiple-trees-to-boost-the-accuracy" class="headerlink" title="Use multiple trees to boost the accuracy"></a>Use multiple trees to boost the accuracy</h1><p>You may wonder why it’s called the random forest when we only used one tree? Good question! In fact, we shouldn’t only use one tree. The correct process is as follows.</p>
<ol>
<li>Choose 90% of the data randomly for training.</li>
<li>Train those data, i.e. the process of building a tree shown above.</li>
<li>Use this tree to predict, get the prediction <code>x</code>.</li>
<li>Repeat the above three steps, build another tree, get another prediction <code>y</code>.</li>
<li>Repeat the first three steps again, get another prediction <code>z</code>.</li>
<li>Choose the one that appears the most in <code>x, y, z</code>, which should be our final prediction, return it.</li>
</ol>
<p>So you should know why it’s call random forest, right? We built 3 trees in total, and got the final result based on 3 predictions obtained from 3 trees. The number 3 can be changed, too. You can also build 5 trees, 10 trees, etc., whatever works out for you. Moreover, the sampling ratio 90% can be changed, too. 80%, 70%, whatever you like.</p>
<p>The purpose of building multiple trees is to avoid overfitting. From Wikipedia:</p>
<blockquote>
<p>In statistics, <strong>overfitting</strong> is “the production of an analysis that corresponds too closely or exactly to a particular set of data, and may therefore fail to fit additional data or predict future observations reliably”.</p>
</blockquote>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><p>Now that we know how it works, it’s time for us to dive into the code. Notice that some parameters in the code are not mentioned before, so let’s review them together.</p>
<ol>
<li>min_size: when the number of data in some node is less than <code>min_size</code>, further splitting is not allowed. I.e., the current group is taken as a leaf node, the value of the leaf node is determined by the category that appears the most in the group.</li>
<li>max_depth: The maximum depth of a tree, further splitting is not allowed when <code>max_depth</code> is exceeded, the value of the node is determined by the category that appears the most in the group.</li>
<li>n_features: The number of features chosen to build the current tree. In case if you don’t know what a feature is, weight, height, 100m-race time are both called features in the previous example. We choose <code>n_features</code> features for training each time we build a tree. In this way, features used in each tree is different, which means the final trees we build will be different, so overfitting could be avoid.</li>
</ol>
<p>Code to implement random forest is as follows.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data)</span>:</span></div><div class="line"></div><div class="line">        <span class="comment"># all the data that is held by this node</span></div><div class="line">        self.data = data</div><div class="line"></div><div class="line">        <span class="comment"># left child node</span></div><div class="line">        self.left = <span class="keyword">None</span></div><div class="line"></div><div class="line">        <span class="comment"># right child node</span></div><div class="line">        self.right = <span class="keyword">None</span></div><div class="line"></div><div class="line">        <span class="comment"># category if the current node is a leaf node</span></div><div class="line">        self.category = <span class="keyword">None</span></div><div class="line"></div><div class="line">        <span class="comment"># a tuple: (row, column), representing the point where we split the data</span></div><div class="line">        <span class="comment"># into the left/right node</span></div><div class="line">        self.split_point = <span class="keyword">None</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_model</span><span class="params">(train_data, n_trees, max_depth, min_size, n_features, n_sample_rate)</span>:</span></div><div class="line">    trees = []</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n_trees):</div><div class="line">        random.shuffle(train_data)</div><div class="line">        n_samples = int(len(train_data) * n_sample_rate)</div><div class="line">        tree = build_tree(train_data[: n_samples], <span class="number">1</span>, max_depth, min_size, n_features)</div><div class="line">        trees.append(tree)</div><div class="line">    <span class="keyword">return</span> trees</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict_with_single_tree</span><span class="params">(tree, row)</span>:</span></div><div class="line">    <span class="keyword">if</span> tree.category <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">        <span class="keyword">return</span> tree.category</div><div class="line">    x, y = tree.split_point</div><div class="line">    split_value = tree.data[x][y]</div><div class="line">    <span class="keyword">if</span> row[y] &lt;= split_value:</div><div class="line">        <span class="keyword">return</span> predict_with_single_tree(tree.left, row)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> predict_with_single_tree(tree.right, row)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(trees, row)</span>:</span></div><div class="line">    prediction = []</div><div class="line">    <span class="keyword">for</span> tree <span class="keyword">in</span> trees:</div><div class="line">        prediction.append(predict_with_single_tree(tree, row))</div><div class="line">    <span class="keyword">return</span> max(set(prediction), key=prediction.count)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_most_common_category</span><span class="params">(data)</span>:</span></div><div class="line">    categories = [row[<span class="number">-1</span>] <span class="keyword">for</span> row <span class="keyword">in</span> data]</div><div class="line">    <span class="keyword">return</span> max(set(categories), key=categories.count)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_tree</span><span class="params">(train_data, depth, max_depth, min_size, n_features)</span>:</span></div><div class="line">    root = Node(train_data)</div><div class="line">    x, y = get_split_point(train_data, n_features)</div><div class="line">    left_group, right_group = split(train_data, x, y)</div><div class="line">    <span class="keyword">if</span> len(left_group) == <span class="number">0</span> <span class="keyword">or</span> len(right_group) == <span class="number">0</span> <span class="keyword">or</span> depth &gt;= max_depth:</div><div class="line">        root.category = get_most_common_category(left_group + right_group)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        root.split_point = (x, y)</div><div class="line">        <span class="keyword">if</span> len(left_group) &lt; min_size:</div><div class="line">            root.left = Node(left_group)</div><div class="line">            root.left.category = get_most_common_category(left_group)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            root.left = build_tree(left_group, depth + <span class="number">1</span>, max_depth, min_size, n_features)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> len(right_group) &lt; min_size:</div><div class="line">            root.right = Node(right_group)</div><div class="line">            root.right.category = get_most_common_category(right_group)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            root.right = build_tree(right_group, depth + <span class="number">1</span>, max_depth, min_size, n_features)</div><div class="line">    <span class="keyword">return</span> root</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_features</span><span class="params">(n_selected_features, n_total_features)</span>:</span></div><div class="line">    features = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(n_total_features)]</div><div class="line">    random.shuffle(features)</div><div class="line">    <span class="keyword">return</span> features[:n_selected_features]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_categories</span><span class="params">(data)</span>:</span></div><div class="line">    <span class="keyword">return</span> set([row[<span class="number">-1</span>] <span class="keyword">for</span> row <span class="keyword">in</span> data])</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_split_point</span><span class="params">(data, n_features)</span>:</span></div><div class="line">    n_total_features = len(data[<span class="number">0</span>]) - <span class="number">1</span></div><div class="line">    features = get_features(n_features, n_total_features)</div><div class="line">    categories = get_categories(data)</div><div class="line">    x, y, gini_index = <span class="keyword">None</span>, <span class="keyword">None</span>, <span class="keyword">None</span></div><div class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> range(len(data)):</div><div class="line">        <span class="keyword">for</span> feature <span class="keyword">in</span> features:</div><div class="line">            left, right = split(data, index, feature)</div><div class="line">            current_gini_index = get_gini_index(left, right, categories)</div><div class="line">            <span class="keyword">if</span> gini_index <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> current_gini_index &lt; gini_index:</div><div class="line">                x, y, gini_index = index, feature, current_gini_index</div><div class="line">    <span class="keyword">return</span> x, y</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_gini_index</span><span class="params">(left, right, categories)</span>:</span></div><div class="line">    gini_index = <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> group <span class="keyword">in</span> left, right:</div><div class="line">        <span class="keyword">if</span> len(group) == <span class="number">0</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        score = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> category <span class="keyword">in</span> categories:</div><div class="line">            p = [row[<span class="number">-1</span>] <span class="keyword">for</span> row <span class="keyword">in</span> group].count(category) / len(group)</div><div class="line">            score += p * p</div><div class="line">        gini_index += (<span class="number">1</span> - score) * (len(group) / len(left + right))</div><div class="line">    <span class="keyword">return</span> gini_index</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(data, x, y)</span>:</span></div><div class="line">    split_value = data[x][y]</div><div class="line">    left, right = [], []</div><div class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> data:</div><div class="line">        <span class="keyword">if</span> row[y] &lt;= split_value:</div><div class="line">            left.append(row)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            right.append(row)</div><div class="line">    <span class="keyword">return</span> left, right</div></pre></td></tr></table></figure>
<p>So how to use this piece of code? Let’s take <a href="https://archive.ics.uci.edu/ml/datasets/connectionist+bench+%28sonar,+mines+vs.+rocks%29" target="_blank" rel="external">Sonar</a>, which is real-life data as an example(You can have a glimpse of its contents in <a href="https://github.com/searene/demos/blob/master/RandomForest/resources/sonar.all-data.csv" target="_blank" rel="external">here</a>). The last column in Sonar represents category, which are two of them in total, R and M. R means rock and M means metal. The first 60 columns represents data obtained by bouncing sonar signals off a surface(R or M) at various angles and under various conditions. Let’s load these data and split them into two groups, one for training and one for testing. Training data is used to build models, and test data is used to check the accuracy of the model.</p>
<p>The code is as follows.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</div><div class="line"></div><div class="line"><span class="keyword">from</span> random_forest <span class="keyword">import</span> build_model, predict</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CrossValidationSplitter</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data, k_fold)</span>:</span></div><div class="line">        self.data = data</div><div class="line">        self.k_fold = k_fold</div><div class="line">        self.n_iteration = <span class="number">0</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.n_iteration &gt;= self.k_fold:</div><div class="line">            <span class="keyword">raise</span> StopIteration</div><div class="line">        self.n_iteration += <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> self.__load_data()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__load_data</span><span class="params">(self)</span>:</span></div><div class="line">        n_train_data = (<span class="number">1</span> / self.k_fold) * len(self.data)</div><div class="line">        data_copy = self.data[:]</div><div class="line">        train_data = []</div><div class="line">        <span class="keyword">while</span> len(train_data) &lt; n_train_data:</div><div class="line">            train_data.append(self.__pop_random_row(data_copy))</div><div class="line">        test_data = data_copy</div><div class="line">        <span class="keyword">return</span> train_data, test_data</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__pop_random_row</span><span class="params">(self, data)</span>:</span></div><div class="line">        random.shuffle(data)</div><div class="line">        <span class="keyword">return</span> data[<span class="number">0</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">split_data</span><span class="params">(data, rate)</span>:</span></div><div class="line">    random.shuffle(data)</div><div class="line">    n_train_data = int(len(data) * rate)</div><div class="line">    <span class="keyword">return</span> data[: n_train_data], data[n_train_data:]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_accuracy</span><span class="params">(model, validate_data)</span>:</span></div><div class="line">    n_total = <span class="number">0</span></div><div class="line">    n_correct = <span class="number">0</span></div><div class="line">    predicted_categories = [predict(model, row[:<span class="number">-1</span>]) <span class="keyword">for</span> row <span class="keyword">in</span> validate_data]</div><div class="line">    correct_categories = [row[<span class="number">-1</span>] <span class="keyword">for</span> row <span class="keyword">in</span> validate_data]</div><div class="line">    <span class="keyword">for</span> predicted_category, correct_category <span class="keyword">in</span> zip(predicted_categories, correct_categories):</div><div class="line">        n_total += <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> predicted_category == correct_category:</div><div class="line">            n_correct += <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> n_correct / n_total</div><div class="line"></div><div class="line"></div><div class="line">df = pd.read_csv(<span class="string">'resources/sonar.all-data.csv'</span>, header=<span class="keyword">None</span>)</div><div class="line">data = df.values.tolist()</div><div class="line">train_data_all, test_data = split_data(data, <span class="number">0.9</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> n_tree <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">10</span>]:</div><div class="line">    accuracies = []</div><div class="line">    cross_validation_splitter = CrossValidationSplitter(train_data_all, <span class="number">5</span>)</div><div class="line">    model = <span class="keyword">None</span></div><div class="line">    <span class="keyword">for</span> train_data, validate_data <span class="keyword">in</span> cross_validation_splitter:</div><div class="line">        n_features = int(sqrt(len(train_data[<span class="number">0</span>]) - <span class="number">1</span>))</div><div class="line">        model = build_model(</div><div class="line">            train_data=train_data,</div><div class="line">            n_trees=n_tree,</div><div class="line">            max_depth=<span class="number">5</span>,</div><div class="line">            min_size=<span class="number">1</span>,</div><div class="line">            n_features=n_features,</div><div class="line">            n_sample_rate=<span class="number">0.9</span></div><div class="line">        )</div><div class="line">        accuracies.append(calculate_accuracy(model, validate_data))</div><div class="line">    print(<span class="string">"Average cross validation accuracy for &#123;&#125; trees: &#123;&#125;"</span>.format(n_tree, np.mean(accuracies)))</div><div class="line">    print(<span class="string">"Test accuracy for &#123;&#125; trees: &#123;&#125;"</span>.format(n_tree, calculate_accuracy(model, test_data)))</div></pre></td></tr></table></figure>
<p>The result is as follows.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Average cross validation accuracy for 1 trees: 0.6887700534759359</div><div class="line">Test accuracy for 1 trees: 0.6190476190476191</div><div class="line">Average cross validation accuracy for 3 trees: 0.6898395721925135</div><div class="line">Test accuracy for 3 trees: 0.8571428571428571</div><div class="line">Average cross validation accuracy for 10 trees: 0.6983957219251338</div><div class="line">Test accuracy for 10 trees: 0.7619047619047619</div></pre></td></tr></table></figure>
<p>As you can see, we get the highest accuracy with 3 trees(around 85%), we have reason to believe that we could get a better result if further tunning is conducted.</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://searene.me/2017/12/23/Write-Machine-Learning-Algorithms-From-Scratch-Random-Forest/" data-id="cjjhacqee00528arfwgkamihw" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/searene" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1031769/searene?tab=profile" target="_blank">
                        <i class="icon fa fa-stack-overflow"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="http://feeds.feedburner.com/Searene" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2018/01/20/We-are-either-young-or-old-never-something-in-between/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            We are either young or old, never something in between
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2017/12/17/My-Last-Weekend-At-Cisco/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">My Last Weekend At Cisco</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/04/07/Went-to-Qiandao-Lake/" class="thumbnail">
    
    
        <span style="background-image:url(/images/IMG_20180406_084153.jpg)" alt="Went to Qiandao Lake" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Journal/">Journal</a></p>
                            <p class="item-title"><a href="/2018/04/07/Went-to-Qiandao-Lake/" class="title">Went to Qiandao Lake</a></p>
                            <p class="item-date"><time datetime="2018-04-07T02:48:09.000Z" itemprop="datePublished">2018-04-07</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/04/03/Go-to-KTV-alone/" class="thumbnail">
    
    
        <span style="background-image:url(/images/1_1354265864.jpg)" alt="Go to KTV alone" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Journal/">Journal</a></p>
                            <p class="item-title"><a href="/2018/04/03/Go-to-KTV-alone/" class="title">Go to KTV alone</a></p>
                            <p class="item-date"><time datetime="2018-04-02T23:10:10.000Z" itemprop="datePublished">2018-04-03</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/04/01/live-a-quite-life/" class="thumbnail">
    
    
        <span style="background-image:url(/images/8608094661_f6fdcc0c83_b.jpg)" alt="live a quite life" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Journal/">Journal</a></p>
                            <p class="item-title"><a href="/2018/04/01/live-a-quite-life/" class="title">live a quite life</a></p>
                            <p class="item-date"><time datetime="2018-04-01T01:50:26.000Z" itemprop="datePublished">2018-04-01</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/03/05/The-meaning-of-life/" class="thumbnail">
    
    
        <span style="background-image:url(/images/980x.png)" alt="The meaning of life" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Journal/">Journal</a></p>
                            <p class="item-title"><a href="/2018/03/05/The-meaning-of-life/" class="title">The meaning of life</a></p>
                            <p class="item-date"><time datetime="2018-03-05T10:53:53.000Z" itemprop="datePublished">2018-03-05</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/01/20/We-are-either-young-or-old-never-something-in-between/" class="thumbnail">
    
    
        <span style="background-image:url(/images/128910133_14610369084721n.jpg)" alt="We are either young or old, never something in between" class="thumbnail-image"></span>
    
    
</a>
                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Journey/">Journey</a></p>
                            <p class="item-title"><a href="/2018/01/20/We-are-either-young-or-old-never-something-in-between/" class="title">We are either young or old, never something in between</a></p>
                            <p class="item-date"><time datetime="2018-01-20T07:55:01.000Z" itemprop="datePublished">2018-01-20</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Coding/">Coding</a><span class="category-list-count">48</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Journal/">Journal</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Journey/">Journey</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a><span class="category-list-count">5</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">14</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Big-Data/">Big Data</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Scala/">Java, Scala</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Neural-Network/">Neural Network</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scala/">Scala</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anki/">anki</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/">book</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/">chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/composition/">composition</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/">django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dnsmasq/">dnsmasq</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encoding/">encoding</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fcitx/">fcitx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firefox/">firefox</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hueman/">hueman</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/i3/">i3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/">jvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/limit/">limit</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/machine-learning/">machine learning</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mathjax/">mathjax</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/multi-thread-java-scala/">multi-thread, java, scala</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysqldb/">mysqldb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">network</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/poisson/">poisson</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/probability/">probability</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proof/">proof</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pycharm/">pycharm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/set-thoery/">set-thoery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualbox/">virtualbox</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win7/">win7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/">zsh</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/Big-Data/" style="font-size: 10px;">Big Data</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Java-Scala/" style="font-size: 10px;">Java, Scala</a> <a href="/tags/Kafka/" style="font-size: 10px;">Kafka</a> <a href="/tags/Neural-Network/" style="font-size: 10px;">Neural Network</a> <a href="/tags/Scala/" style="font-size: 12px;">Scala</a> <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/anki/" style="font-size: 16px;">anki</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/composition/" style="font-size: 10px;">composition</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/dnsmasq/" style="font-size: 10px;">dnsmasq</a> <a href="/tags/encoding/" style="font-size: 10px;">encoding</a> <a href="/tags/fcitx/" style="font-size: 12px;">fcitx</a> <a href="/tags/firefox/" style="font-size: 10px;">firefox</a> <a href="/tags/git/" style="font-size: 12px;">git</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/hexo/" style="font-size: 14px;">hexo</a> <a href="/tags/hueman/" style="font-size: 10px;">hueman</a> <a href="/tags/i3/" style="font-size: 10px;">i3</a> <a href="/tags/java/" style="font-size: 16px;">java</a> <a href="/tags/javascript/" style="font-size: 14px;">javascript</a> <a href="/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/leetcode/" style="font-size: 10px;">leetcode</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/limit/" style="font-size: 12px;">limit</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/machine-learning/" style="font-size: 10px;">machine learning</a> <a href="/tags/math/" style="font-size: 14px;">math</a> <a href="/tags/mathjax/" style="font-size: 10px;">mathjax</a> <a href="/tags/multi-thread-java-scala/" style="font-size: 10px;">multi-thread, java, scala</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/mysqldb/" style="font-size: 10px;">mysqldb</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/poisson/" style="font-size: 10px;">poisson</a> <a href="/tags/probability/" style="font-size: 10px;">probability</a> <a href="/tags/proof/" style="font-size: 10px;">proof</a> <a href="/tags/pycharm/" style="font-size: 10px;">pycharm</a> <a href="/tags/python/" style="font-size: 18px;">python</a> <a href="/tags/set-thoery/" style="font-size: 10px;">set-thoery</a> <a href="/tags/shell/" style="font-size: 12px;">shell</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/ubuntu/" style="font-size: 14px;">ubuntu</a> <a href="/tags/vim/" style="font-size: 14px;">vim</a> <a href="/tags/virtualbox/" style="font-size: 10px;">virtualbox</a> <a href="/tags/win7/" style="font-size: 10px;">win7</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 Searene</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'searene';
    
    
    var disqus_url = 'http://searene.me/2017/12/23/Write-Machine-Learning-Algorithms-From-Scratch-Random-Forest/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    

    
        <script src="/vendor/scrollLoading/jquery.scrollLoading.js"></script>
        <script src="/vendor/scrollLoading/main.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>
</script>

        <!-- mathjax config similar to math.stackexchange -->

<script type="text/javascript">
$(document).ready(function(){
  $("code").map(function(){
    match = /^\$(.*)\$$/.exec($(this).html());
    if (match){
      //$(this).after("<span class=mathjax_inline>" + match + "</span>");
      //$(this).hide();
      $(this).replaceWith("<span class=hpl_mathjax_inline>" + $(this).html() + "</span>");
      MathJax.Hub.Queue(["Typeset",MathJax.Hub,$(this).get(0)]);
    }
  });
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

    </div>
</body>
</html>
